<!DOCTYPE html>
<html>

<head>
    <title>Bataan MaiMai Experimental</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <h1>Bataan MaiMai Queue</h1>
    <div id="queue"></div>
    <button onclick="addPlayer()">Add Player</button>
    <button onclick="swapPlayers()">Swap Players</button>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <h2>Admin Login</h2>
            <input type="password" id="adminPassword" placeholder="Enter admin password">
            <button id="adminLoginButton">Login</button>
        </div>
    </div>

    <!-- Admin Controls (Hidden by default) -->
    <div id="adminControls" style="display: none;">
        <h3>Admin Controls</h3>

        <!-- Delete Player by Position -->
        <h4>Delete Player by Position</h4>
        <input type="number" id="deletePosition" placeholder="Enter position">
        <button onclick="deletePlayerByPosition()">Delete Player</button>

        <!-- Display Current Players -->
        <h4>Display Current Players</h4>
        <button onclick="displayCurrentPlayers()">Display Current Players</button>
        <div id="currentPlayersDisplay"></div>

        <!-- Mark Player as Paid -->
        <h4>Mark Player as Paid</h4>
        <input type="checkbox" id="markPaid"> Mark as Paid
        <button onclick="markPlayerAsPaid()">Update Payment Status</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        let queue = [];
        let isAdmin = false;

        // Handle admin login
        document.getElementById('adminLoginButton').addEventListener('click', () => {
            const enteredPassword = document.getElementById('adminPassword').value;
            if (enteredPassword === 'maimaibataan') {
                localStorage.setItem('isAdmin', 'true');
                document.getElementById('adminLoginModal').style.display = 'none';
                enableAdminFeatures();
            } else {
                alert('Incorrect password.');
            }
        });

        // Enable admin functionality
        function enableAdminFeatures() {
            if (localStorage.getItem('isAdmin') === 'true') {
                document.getElementById('adminControls').style.display = 'block';
                isAdmin = true;
            }
        }

        // Show modal if not authenticated
        window.onload = () => {
            if (localStorage.getItem('isAdmin') === 'true') {
                enableAdminFeatures();
                document.getElementById('adminLoginModal').style.display = 'none';
            } else {
                document.getElementById('adminLoginModal').style.display = 'block';
            }
        };

        // Add player
        function addPlayer() {
            const playerName = prompt('Enter player name:');
            if (playerName) {
                socket.emit('addPlayer', playerName);
            }
        }

        // Swap players
        function swapPlayers() {
            if (queue.length >= 2) {
                [queue[0], queue[1]] = [queue[1], queue[0]];
                socket.emit('queueUpdate', queue);
            }
        }

        // Delete player by position
        function deletePlayerByPosition() {
            if (!isAdmin) {
                alert('Admin access required.');
                return;
            }
            const position = parseInt(document.getElementById('deletePosition').value, 10);
            if (position >= 0 && position < queue.length) {
                queue.splice(position, 1);
                socket.emit('queueUpdate', queue);
                alert('Player deleted successfully.');
            } else {
                alert('Invalid position.');
            }
        }

        // Display current players
        function displayCurrentPlayers() {
            const currentPlayers = queue.slice(0, 2);
            const displayDiv = document.getElementById('currentPlayersDisplay');
            displayDiv.innerHTML = '';
            currentPlayers.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.textContent = `Player ${index + 1}: ${player.name || player}`;
                displayDiv.appendChild(playerDiv);
            });
        }

        // Mark player as paid
        function markPlayerAsPaid() {
            if (!isAdmin) {
                alert('Admin access required.');
                return;
            }
            const isPaid = document.getElementById('markPaid').checked;
            if (queue.length > 0) {
                queue[0].paid = isPaid;
                socket.emit('queueUpdate', queue);
                alert(`Player marked as ${isPaid ? 'paid' : 'unpaid'}.`);
            } else {
                alert('No players in queue.');
            }
        }

        // Update queue display dynamically
        socket.on('queueUpdate', (updatedQueue) => {
            queue = updatedQueue;
            updateQueueDisplay();
        });

        // Render queue dynamically
        function updateQueueDisplay() {
            const queueDiv = document.getElementById('queue');
            queueDiv.innerHTML = '';
            queue.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.textContent = `${index + 1}. ${player.name || player} ${player.paid ? '[PAID]' : ''}`;
                queueDiv.appendChild(playerDiv);
            });
        }
    </script>

    <style>
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
        }

        #adminControls {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }

        #queue div {
            padding: 5px;
            margin: 5px 0;
            border: 1px solid #ddd;
        }
    </style>
</body>

</html>
